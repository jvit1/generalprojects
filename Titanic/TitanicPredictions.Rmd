```{r}
library(tidyverse)
library(tidymodels)
library(modelr)
library(randomForest)
train <- read.csv("C:/Users/student/Documents/UVA/Portfolio Projects/generalprojects/Titanic/train.csv")
test <- read.csv("C:/Users/student/Documents/UVA/Portfolio Projects/generalprojects/Titanic/test.csv")
```

Exploratory
Let's see how many NA values are in each column.
```{r}
colSums(is.na(train))
colSums(is.na(test))
```

For age, we'll try out inputting the median age of 28, which is found below.
```{r}
train %>% select(Age) %>% summarise(median=median(Age, na.rm=TRUE))
train$Age[is.na(train$Age)] <- 28
```

Let's try running a random forest initially. We may need to predict age later on.
```{r}
train.clean <- train %>% select(-Name, -PassengerId)
RF.1 <- randomForest(Survived ~ . , data = train.clean,
                     mtry = 2, importance= TRUE)

RF.1 %>% importance
```

Now we'll go head and add these to the data then assess the accuracy.
```{r}
#Adding to data
RF.add1 <- train.clean %>%
  add_predictions(RF.1) %>%
  rename(pred_pct = pred) %>%
  mutate(method = "RF.1") %>%
  mutate(prediction = ifelse(pred_pct > .5, 1,0))

RF.add1$Survived <- as.factor(RF.add1$Survived)
RF.add1$prediction <- as.factor(RF.add1$prediction)


#Assessments
RF.add1 %>%
  conf_mat(truth = Survived, estimate = prediction)

RF.add1 %>%
  metrics(truth = Survived, estimate = prediction) %>%
  filter(.metric == "accuracy")
```

Not bad. Let's apply this to the testing data. First, we have to fill the missing values.
```{r}
test %>% select(Age) %>% summarise(median=median(Age, na.rm=TRUE))
test$Age[is.na(test$Age)] <- 27

test %>% select(Fare) %>% summarise(median=median(Fare, na.rm=TRUE))
test$Fare[is.na(test$Fare)] <- 14.4542
```


```{r}
RF.test <- test %>%
  add_predictions(RF.1) %>%
  rename(pred_pct = pred) %>%
  mutate(method = "RF.1") %>%
  mutate(prediction = ifelse(pred_pct > .5, 1,0))

final.results <- RF.test %>%
  select(PassengerId, prediction) %>%
  rename(Survived = prediction)

write.csv(final.results, 'C:/Users/student/Documents/UVA/Portfolio Projects/generalprojects/Titanic/results.csv' , row.names=FALSE)
```

